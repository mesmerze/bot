- entity_name = controller.controller_name.singularize.underscore
- @entity = instance_variable_get("@#{entity_name}")
- create_id = "create_#{entity_name}"

- if @entity.errors.empty?
  $('##{create_id}_arrow').html(crm.COLLAPSED);
  $('##{create_id}_title').html('#{ j t(entity_name.pluralize) }');
  $('##{create_id}').slideUp(250);
  - if called_from_index_page?
    var user = $("#user_#{@entity.assigned_to}");
    if (!user.length) {$.get('/meetings.js');} else {user.find('##{entity_name.pluralize}').prepend('#{ j render(partial: entity_name, collection: [ @entity ]) }');};
  -elsif called_from_landing_page?(:accounts)
    $('##{entity_name.pluralize}').prepend('#{ j render(partial: 'meeting', collection: [ @entity ]) }');
  $('##{dom_id(@entity)}').effect("highlight", { duration:1500 });
  crm.flick('empty', 'remove');
  $('#recently').replaceWith('#{ j render(partial: "shared/recently") }');
- else
  $('##{create_id}').html('#{ j render(partial: "new") }');
  $('##{create_id}').effect("shake", { duration:250, distance: 6 });
  $('#new_#{entity_name} input[type!=hidden]').first().focus();
