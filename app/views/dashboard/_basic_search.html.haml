- model = controller.controller_name.classify.constantize
- sort_by_menu_items = model.sort_by_fields.map { |field| options_menu_item(:sort_by, field) }
- current_sort_by = t("option_" + model.sort_by_map.invert[@sort_by])

%div{ style: "margin: 0px 0px 6px 0px" }
  = text_field_tag('query', @current_query, size: 32, autofocus: true, placeholder: "Search #{model.name}")
  .dashboard_sort{style: "display: inline-block;"}
    %span#title #{t :sort_by, {field: ':'}}
    = select_tag "sort", options_for_select(@options_for_sort, @options_for_sort[7].second), id: 'opportunities_sort'

:javascript
  var searchTimeout;

  $('#query').on('keydown', function(event) {
    $el = $(event.target)
    if (searchTimeout) clearTimeout(searchTimeout);
    searchTimeout = setTimeout(function () { crm.dashboard_search($el.val(), '#{controller_name}'); }, 500);
  });
